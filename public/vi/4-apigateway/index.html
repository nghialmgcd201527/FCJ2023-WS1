<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.114.1">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Cấu hình cho API authorization: API Gateway :: AWS System Manager</title>

    
    <link href="/css/nucleus.css?1689673103" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1689673103" rel="stylesheet">
    <link href="/css/hybrid.css?1689673103" rel="stylesheet">
    <link href="/css/featherlight.min.css?1689673103" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1689673103" rel="stylesheet">
    <link href="/css/auto-complete.css?1689673103" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1689673103" rel="stylesheet">
    <link href="/css/theme.css?1689673103" rel="stylesheet">
    <link href="/css/hugo-theme.css?1689673103" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1689673103" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1689673103"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/vi/4-apigateway/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1689673103"></script>
<script type="text/javascript" src="/js/auto-complete.js?1689673103"></script>
<script type="text/javascript">
    
        var baseurl = "\/vi";
    
</script>
<script type="text/javascript" src="/js/search.js?1689673103"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/vi/1-introduce/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-introduce/">
           <b> 1. </b> Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/2-prerequiste/" title="Các bước chuẩn bị" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-prerequiste/">
           <b> 2. </b> Các bước chuẩn bị
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.1-createcloud9workspace/" title="Tạo Cloud9 Workspace" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-prerequiste/2.1-createcloud9workspace/">
           <b> 2.1 </b> Tạo Cloud9 Workspace
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.2-ensurenodejsversion/" title="Ensure Node.js Version" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-prerequiste/2.2-ensurenodejsversion/">
           <b> 2.2 </b> Ensure Node.js Version
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.3-clonerepositoryandavoidingfreespace/" title="Clone Git repository và vấn đề của dung lượng trống Cloud9" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-prerequiste/2.3-clonerepositoryandavoidingfreespace/">
           <b> 2.3 </b> Clone Git repository và vấn đề của dung lượng trống Cloud9
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.4-installamplifycli/" title="Cài đặt Amplify CLI" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-prerequiste/2.4-installamplifycli/">
           <b> 2.4 </b> Cài đặt Amplify CLI
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/3-serverlessbackend/" title="Xây dựng một serverless backend với AWS Lambda và AWS SAM" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-serverlessbackend/">
           <b> 3. </b> Xây dựng một serverless backend với AWS Lambda và AWS SAM
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/3-serverlessbackend/3.1-dynamodb/" title="Khai báo Table trong DynamoDB" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-serverlessbackend/3.1-dynamodb/">
           <b> 3.1. </b> Khai báo Table trong DynamoDB
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-serverlessbackend/3.2-lambdafunction/" title="Tạo Lambda function" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-serverlessbackend/3.2-lambdafunction/">
           <b> 3.2. </b> Tạo Lambda function
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/4-apigateway/" title="Cấu hình cho API authorization: API Gateway" class="dd-item 
        
        active
        
        ">
      <a href="/vi/4-apigateway/">
           <b> 4. </b> Cấu hình cho API authorization: API Gateway
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/5-deploy/" title="Build và deploy ứng dụng web: AWS Amplify" class="dd-item 
        
        
        
        ">
      <a href="/vi/5-deploy/">
           <b> 5. </b> Build và deploy ứng dụng web: AWS Amplify
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/5-deploy/5.1-deployserverless/" title="Deploy Serverless Application" class="dd-item 
        
        
        
        ">
      <a href="/vi/5-deploy/5.1-deployserverless/">
           <b> 5.1 </b> Deploy Serverless Application
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/5-deploy/5.2-configapigateway/" title="Cấu hình API Gateway endpoint" class="dd-item 
        
        
        
        ">
      <a href="/vi/5-deploy/5.2-configapigateway/">
           <b> 5.2 </b> Cấu hình API Gateway endpoint
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/5-deploy/5.3-initializeamplify/" title="Khởi tạo Amplify" class="dd-item 
        
        
        
        ">
      <a href="/vi/5-deploy/5.3-initializeamplify/">
           <b> 5.3 </b> Khởi tạo Amplify
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/5-deploy/5.4-buildapp/" title="Build ứng dụng web" class="dd-item 
        
        
        
        ">
      <a href="/vi/5-deploy/5.4-buildapp/">
           <b> 5.4 </b> Build ứng dụng web
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/5-deploy/5.5-amplifyhosting/" title="Thêm Amplify Hosting vào ứng dụng" class="dd-item 
        
        
        
        ">
      <a href="/vi/5-deploy/5.5-amplifyhosting/">
           <b> 5.5 </b> Thêm Amplify Hosting vào ứng dụng
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/5-deploy/5.6-deployapp/" title="Deploy ứng dụng" class="dd-item 
        
        
        
        ">
      <a href="/vi/5-deploy/5.6-deployapp/">
           <b> 5.6 </b> Deploy ứng dụng
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/6-test/" title="Kiểm tra ứng dụng" class="dd-item 
        
        
        
        ">
      <a href="/vi/6-test/">
           <b> 6. </b> Kiểm tra ứng dụng
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/6-test/6.1-dynamodb/" title="Deploy Serverless Application" class="dd-item 
        
        
        
        ">
      <a href="/vi/6-test/6.1-dynamodb/">
           <b> 5.1 </b> Deploy Serverless Application
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/6-test/6.2-logandmonitor/" title="Cấu hình API Gateway endpoint" class="dd-item 
        
        
        
        ">
      <a href="/vi/6-test/6.2-logandmonitor/">
           <b> 5.2 </b> Cấu hình API Gateway endpoint
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj/"><i class='fab fa-facebook'></i> AWS Study Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="/4-apigateway/">English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="/vi/4-apigateway/" selected>Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>30-01-2022</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i> <a href="https://www.linkedin.com/in/sutrinh/"  style="color:orange">Sử Trịnh  </a> <br>
                <a href="https://www.linkedin.com/in/jotaguy"  style="color:orange">Gia Hưng </a> <br>
                <a href="https://www.linkedin.com/in/hiepnguyendt"  style="color:orange">Thanh Hiệp </a>
               
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='/vi/'>Session Management</a> > Cấu hình cho API authorization: API Gateway
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Cấu hình cho API authorization: API Gateway
            </h1>
          

        



	<h4 id="lambda-authorizer-là-gì">Lambda Authorizer là gì?</h4>
<p>Lambda authorizer là một tính năng của API Gateway mà nó sử dụng Lambda function để kiểm soát truy cập tới API của bạn. Đó là một cách để bổ sung bảo mật cho API của bạn.</p>
<h4 id="lambda-authorizer-hoạt-động-như-thế-nào">Lambda Authorizer hoạt động như thế nào?</h4>
<p>Khi client gửi request đến một trong những chức năng của API thì API Gateway sẽ gọi đến Lambda authorizer để xác thực client và trả về IAM policy để kiểm tra client đó có được quyền truy cập hay không.</p>
<p>API Gateway hỗ trợ các tiêu chuẩn mở cho các cách xác thực như OAuth và SAML.</p>
<p>Thông thường, intentity provider được sử dụng để xác thực người gửi request đến API. Identity provider phải chịu trách nhiệm xác minh và trả về danh tính của người đó. Sau đó, nó sẽ được chuyến đền Lambda authorizer, nơi chịu trách nhiệm kiểm soát quyền truy cập API của bạn.</p>
<p>Trong workshop này, chúng ta sẽ không triển khai identity provided, vì vậy, thay vào đó, chúng ta sẽ mock identity provider.</p>
<h4 id="json-web-token-jwt">JSON Web Token (JWT)</h4>
<p>Danh tính của người gọi API sẽ được biểu diễn bằng một <a href="https://en.wikipedia.org/wiki/JSON_Web_Token">JSON Web Token (JWT)</a>. Theo wikipedia, &ldquo;A JWT is a compact, self-contained, signed JSON object. The JWT is typically used to represent an authenticated user&rsquo;s identity.&rdquo;</p>
<h5 id="example-jwt"><strong>Example JWT</strong></h5>
<p>Một JWT token bao gồm 3 phần: header, payload và signature. Phần header và payload là những đối tượng dạng JSON. Phần signature là một chuỗi kí tự được sử dụng để xác thực phần header và payload.</p>
<h5 id="header"><strong>Header:</strong></h5>
<p>Loại token (<code>typ</code>) là <strong>JWT.</strong> Thuật toán (<code>alg</code>) là <strong>HS256</strong>, là sự kết hợp giữa <a href="https://en.wikipedia.org/wiki/HMAC">HMAC</a> cùng với <a href="https://en.wikipedia.org/wiki/SHA-2">SHA-256</a></p>
<pre tabindex="0"><code>{
  &#34;typ&#34;: &#34;JWT&#34;,
  &#34;alg&#34;: &#34;HS256&#34;
}
</code></pre><h5 id="payload"><strong>Payload:</strong></h5>
<p>Thuộc tính <strong>iss</strong> là tên của identity provider. Thuộc tính <strong>sub</strong> là tên của người gửi request. Thuộc tính <strong>scope</strong> là quyền của người gửi request. Thuộc tính <strong>jti</strong> là unique identifier cho JWT. Thuộc tính <strong>iat</strong> là thời gian mà token được tạo ra. Thuộc tính <strong>exp</strong> là thời gian mà token hết hạn.</p>
<pre tabindex="0"><code>{
  &#34;iss&#34;: &#34;getting-started-with-serverless&#34;,
  &#34;sub&#34;: &#34;minhnghia&#34;,
  &#34;scope&#34;: &#34;admins&#34;,
  &#34;jti&#34;: &#34;02343566e-8ff3-4a2d-ac18-c4d28ed96881&#34;,
  &#34;iat&#34;: 1633433217,
  &#34;exp&#34;: 4070208800
}
</code></pre><h5 id="signature"><strong>Signature:</strong></h5>
<pre tabindex="0"><code>R2D2RfY_n7OAcuONbpPfxqBY5IppEiGLCCfeQ_wz_2w
</code></pre><p>Các giá trị này đều được mã hóa dạng base64 và nối với form của JWT bằng dấu &ldquo;.&rdquo;, ví dụ như sau:</p>
<pre tabindex="0"><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsb2dnZWRJbkFzIjoiYWRtaW4iLCJpYXQiOjE0MjI3Nzk2Mzh9.gzSraSYS8EXBxLN_oWnFSRgCzcmJmMjLiuyu5CSpyHI
</code></pre><p>Bạn sẽ thấy token được gửi đến API Gateway endpoint bằng ứng dụng web và sử dụng HTTP <strong>Authorization</strong> header.</p>
<h4 id="cấu-hình-lambda-authorizer">Cấu hình Lambda Authorizer</h4>
<p>Coppy đoạn code dưới đây và paste vào file <strong>app.js</strong> trong thư mục <code>sam/src/auth</code>.</p>
<pre tabindex="0"><code>const jwt = require(&#39;njwt&#39;)

exports.handler = function (event, context, callback) {
  console.info(&#39;received:&#39;, event)
  const token = event.authorizationToken.split(&#39; &#39;)[1]
  jwt.verify(token, &#39;secretphrase&#39;, (err, verifiedJwt) =&gt; {
    if (err) {
      console.log(err.message)
      callback(&#39;Error: Invalid token&#39;)
    } else {
      console.log(`Verified token: ${verifiedJwt}`)
      const resource = `${event.methodArn.split(&#39;/&#39;, 2).join(&#39;/&#39;)}/*`
      const policy = generatePolicy(verifiedJwt.body.sub, &#39;Allow&#39;, resource)
      console.log(`Generated policy: ${JSON.stringify(policy)}`)
      callback(null, policy)
    }
  })
}

const generatePolicy = function (principalId, effect, resource) {
  const authResponse = {}

  authResponse.principalId = principalId
  if (effect &amp;&amp; resource) {
    const policyDocument = {}
    policyDocument.Version = &#39;2012-10-17&#39;
    policyDocument.Statement = []
    const statementOne = {}
    statementOne.Action = &#39;execute-api:Invoke&#39;
    statementOne.Effect = effect
    statementOne.Resource = resource
    policyDocument.Statement[0] = statementOne
    authResponse.policyDocument = policyDocument
  }

  authResponse.context = {
    userId: 1,
    createdAt: new Date().toISOString()
  }
  return authResponse
}
</code></pre><p>Đoạn code phía trên sẽ xác minh và xác thực những request được gửi đến API bằng cách sử dụng JSON Web Token (JWT) và trả về một IAM policy cho người được xác thực đó.</p>
<p>Bắt đầu, chúng ta sẽ import thư viện <strong>njwt</strong>, nó được dùng cho xác thực JWT.</p>
<p><strong>exports.handler</strong> là entry point của Lambda function. Nó sẽ nhận vào một event, một context và một callback. Event chứa các thông tin về request gửi đến API. Context chứa các thông tin về Lambda function. Callback sẽ được gọi khi Lambda function hoàn thành.</p>
<p>JWT token được trích xuất từ authorizationToken trong phần header của request. Sẽ có một phương thức phân tách được sử dùng để xóa tiền tố <strong>Bearer</strong> và truy xuất mã token thực sự.</p>
<p>Hàm <code>jwt.verify</code> được sử dụng để xác minh token bằng cách sử dụng <strong>secretphrase</strong>. Nếu token không hợp lệ, Lambda function sẽ trả về một lỗi. Nếu token hợp lệ, object JWT được xác thực đó sẽ được lấy đi và xử lí.</p>
<p>Biến <strong>resource</strong> được đặt để đại diện cho những resource được yêu cầu từ API request.</p>
<p>Hàm <code>generatePolicy</code> được sử dụng để tạo ra một IAM policy. Nó sẽ lấy giá trị của <strong>sub (subject)</strong> từ body của JWT, chuyển <strong>effect</strong> thành <strong>Allow</strong> và sử dụng biến <strong>resource</strong> để làm rõ policy đó.</p>
<p>Tóm lại, đoạn code ở trên là một phương thức xác thực đơn giản dựa vào token, nó dùng để mô tả cách sử dụng token để xác thực request. Token được truyền bằng header của <strong>Authorization.</strong> Sau đó chúng ta sẽ xác minh token bằng cách sử dụng (secretphrase). Đó là một passphrase rất phổ biến, được áp dụng trong ứng dụng web. Chúng ta chỉ đơn giản là mock identity provider. Trong thực tế, chúng ta sẽ sử dụng một identity provider uy tín, chẳng hạn như Amazon Cognito, để xác minh danh tính của người dùng.</p>
<h4 id="iam-policy-document">IAM Policy Document</h4>
<p>Đây là ví dụ về IAM policy document được trả về tới người gọi. Ở đây, principal <strong>minhnghia</strong> được cấp quyền truy cập đến các method của API Gateway.</p>
<pre tabindex="0"><code>{
    &#34;principalId&#34;: &#34;minhnghia&#34;,
    &#34;policyDocument&#34;: {
        &#34;Version&#34;: &#34;2012-10-17&#34;,
        &#34;Statement&#34;: [
            {
                &#34;Action&#34;: &#34;execute-api:Invoke&#34;,
                &#34;Effect&#34;: &#34;Allow&#34;,
                &#34;Resource&#34;: &#34;arn:aws:execute-api:us-east-1:0123456789012:dn3fidb5ng0/v1/*&#34;
            }
        ]
    },
    &#34;context&#34;: {
        &#34;userId&#34;: 1,
        &#34;createdAt&#34;: &#34;2021-10-01T19:53:34.594Z&#34;
    }
}
</code></pre><p><strong>principalId</strong> đại diện cho indentify của người dùng được gán với request. Trong đoạn code này, nó được gán giá trị <strong>minhnghia</strong>, IAM policy này được gán với người dùng này cùng identifier là <strong>minhnghia</strong>.</p>
<p>object <strong>policyDocument</strong> xác định quyền được gán trong policy. <strong>Version</strong> là phiên bản của ngôn ngữ viết policy đang được sử dụng hiện tại là <code>2012-10-17</code>. <strong>Statement</strong> là một mảng các quyền được gán cho người dùng. Trong đoạn code này, nó chỉ có một quyền duy nhất là <strong>execute-api:Invoke</strong>. <strong>Effect</strong> là một trong hai giá trị <strong>Allow</strong> hoặc <strong>Deny</strong>. <strong>Resource</strong> là một định danh duy nhất cho một resource cụ thể. Trong đoạn code này, nó là một định danh cho một API Gateway endpoint.</p>
<p><strong>context</strong> là một object chứa các thông tin bổ sung về người dùng. Nó có thể được sử dụng để truyền các thông tin bổ sung về người dùng đến Lambda function. Trong đoạn code này, nó chứa hai thông tin là <strong>userId</strong> và <strong>createdAt</strong>. Cái này có lợi trong việc debugging và kiểm tra các request của người dùng đó.</p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/vi/3-serverlessbackend/3.2-lambdafunction/" title="Tạo Lambda function"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/vi/5-deploy/" title="Build và deploy ứng dụng web: AWS Amplify" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1689673103"></script>
    <script src="/js/perfect-scrollbar.min.js?1689673103"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1689673103"></script>
    <script src="/js/jquery.sticky.js?1689673103"></script>
    <script src="/js/featherlight.min.js?1689673103"></script>
    <script src="/js/highlight.pack.js?1689673103"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1689673103"></script>
    <script src="/js/learn.js?1689673103"></script>
    <script src="/js/hugo-learn.js?1689673103"></script>

    <link href="/mermaid/mermaid.css?1689673103" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1689673103"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
