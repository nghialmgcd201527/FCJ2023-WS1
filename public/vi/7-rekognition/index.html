<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.114.1">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="../../images/favicon.png" type="image/png">

    <title>Cấu hình cho trích xuất metadata từ hình ảnh: Amazon Rekognition :: AWS System Manager</title>

    
    <link href="../../css/nucleus.css?1692235183" rel="stylesheet">
    <link href="../../css/fontawesome-all.min.css?1692235183" rel="stylesheet">
    <link href="../../css/hybrid.css?1692235183" rel="stylesheet">
    <link href="../../css/featherlight.min.css?1692235183" rel="stylesheet">
    <link href="../../css/perfect-scrollbar.min.css?1692235183" rel="stylesheet">
    <link href="../../css/auto-complete.css?1692235183" rel="stylesheet">
    <link href="../../css/atom-one-dark-reasonable.css?1692235183" rel="stylesheet">
    <link href="../../css/theme.css?1692235183" rel="stylesheet">
    <link href="../../css/hugo-theme.css?1692235183" rel="stylesheet">
    
    <link href="../../css/theme-workshop.css?1692235183" rel="stylesheet">
    
    

    <script src="../../js/jquery-3.3.1.min.js?1692235183"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="../../vi/7-rekognition/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="../../">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../../js/lunr.min.js?1692235183"></script>
<script type="text/javascript" src="../../js/auto-complete.js?1692235183"></script>
<script type="text/javascript">
    
        var baseurl = "\/vi";
    
</script>
<script type="text/javascript" src="../../js/search.js?1692235183"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/vi/1-introduce/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="../../vi/1-introduce/">
           <b> 1. </b> Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/2-prerequiste/" title="Các bước chuẩn bị" class="dd-item 
        
        
        
        ">
      <a href="../../vi/2-prerequiste/">
           <b> 2. </b> Các bước chuẩn bị
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.1-createcloud9workspace/" title="Tạo Cloud9 Workspace" class="dd-item 
        
        
        
        ">
      <a href="../../vi/2-prerequiste/2.1-createcloud9workspace/">
           <b> 2.1 </b> Tạo Cloud9 Workspace
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.2-ensurenodejsversion/" title="Ensure Node.js Version" class="dd-item 
        
        
        
        ">
      <a href="../../vi/2-prerequiste/2.2-ensurenodejsversion/">
           <b> 2.2 </b> Ensure Node.js Version
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.3-clonerepositoryandavoidingfreespace/" title="Clone Git repository và vấn đề của dung lượng trống Cloud9" class="dd-item 
        
        
        
        ">
      <a href="../../vi/2-prerequiste/2.3-clonerepositoryandavoidingfreespace/">
           <b> 2.3 </b> Clone Git repository và vấn đề của dung lượng trống Cloud9
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.4-installamplifycli/" title="Cài đặt Amplify CLI" class="dd-item 
        
        
        
        ">
      <a href="../../vi/2-prerequiste/2.4-installamplifycli/">
           <b> 2.4 </b> Cài đặt Amplify CLI
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/3-serverlessbackend/" title="Xây dựng một serverless backend với AWS Lambda và AWS SAM" class="dd-item 
        
        
        
        ">
      <a href="../../vi/3-serverlessbackend/">
           <b> 3. </b> Xây dựng một serverless backend với AWS Lambda và AWS SAM
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/3-serverlessbackend/3.1-dynamodb/" title="Khai báo Table trong DynamoDB" class="dd-item 
        
        
        
        ">
      <a href="../../vi/3-serverlessbackend/3.1-dynamodb/">
           <b> 3.1. </b> Khai báo Table trong DynamoDB
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-serverlessbackend/3.2-lambdafunction/" title="Tạo Lambda function" class="dd-item 
        
        
        
        ">
      <a href="../../vi/3-serverlessbackend/3.2-lambdafunction/">
           <b> 3.2. </b> Tạo Lambda function
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/4-apigateway/" title="Cấu hình cho API authorization: API Gateway" class="dd-item 
        
        
        
        ">
      <a href="../../vi/4-apigateway/">
           <b> 4. </b> Cấu hình cho API authorization: API Gateway
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/5-deploy/" title="Build và deploy ứng dụng web: AWS Amplify" class="dd-item 
        
        
        
        ">
      <a href="../../vi/5-deploy/">
           <b> 5. </b> Build và deploy ứng dụng web: AWS Amplify
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/5-deploy/5.1-deployserverless/" title="Deploy Serverless Application" class="dd-item 
        
        
        
        ">
      <a href="../../vi/5-deploy/5.1-deployserverless/">
           <b> 5.1 </b> Deploy Serverless Application
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/5-deploy/5.2-configapigateway/" title="Cấu hình API Gateway endpoint" class="dd-item 
        
        
        
        ">
      <a href="../../vi/5-deploy/5.2-configapigateway/">
           <b> 5.2 </b> Cấu hình API Gateway endpoint
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/5-deploy/5.3-initializeamplify/" title="Khởi tạo Amplify" class="dd-item 
        
        
        
        ">
      <a href="../../vi/5-deploy/5.3-initializeamplify/">
           <b> 5.3 </b> Khởi tạo Amplify
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/5-deploy/5.4-buildapp/" title="Build ứng dụng web" class="dd-item 
        
        
        
        ">
      <a href="../../vi/5-deploy/5.4-buildapp/">
           <b> 5.4 </b> Build ứng dụng web
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/5-deploy/5.5-amplifyhosting/" title="Thêm Amplify Hosting vào ứng dụng" class="dd-item 
        
        
        
        ">
      <a href="../../vi/5-deploy/5.5-amplifyhosting/">
           <b> 5.5 </b> Thêm Amplify Hosting vào ứng dụng
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/5-deploy/5.6-deployapp/" title="Deploy ứng dụng" class="dd-item 
        
        
        
        ">
      <a href="../../vi/5-deploy/5.6-deployapp/">
           <b> 5.6 </b> Deploy ứng dụng
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/6-test/" title="Chạy thử ứng dụng" class="dd-item 
        
        
        
        ">
      <a href="../../vi/6-test/">
           <b> 6. </b> Chạy thử ứng dụng
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/6-test/6.1-dynamodb/" title="Quản lí dữ liệu trong DynamoDB" class="dd-item 
        
        
        
        ">
      <a href="../../vi/6-test/6.1-dynamodb/">
           <b> 6.1 </b> Quản lí dữ liệu trong DynamoDB
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/6-test/6.2-logandmonitor/" title="Logging và Monitoring" class="dd-item 
        
        
        
        ">
      <a href="../../vi/6-test/6.2-logandmonitor/">
           <b> 6.2 </b> Logging và Monitoring
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/7-rekognition/" title="Cấu hình cho trích xuất metadata từ hình ảnh: Amazon Rekognition" class="dd-item 
        
        active
        
        ">
      <a href="../../vi/7-rekognition/">
           <b> 7. </b> Cấu hình cho trích xuất metadata từ hình ảnh: Amazon Rekognition
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/8-terminate/" title="Dọn dẹp tài nguyên" class="dd-item 
        
        
        
        ">
      <a href="../../vi/8-terminate/">
           <b> 8. </b> Dọn dẹp tài nguyên
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj/"><i class='fab fa-facebook'></i> AWS Study Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="/7-rekognition/">English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="/vi/7-rekognition/" selected>Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>30-01-2022</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
                <a href="https://www.linkedin.com/in/jotaguy"  style="color:orange">Gia Hưng </a> <br>
                <a href="#"  style="color:orange">Hoàng Kha</a> <br>
                <a href="https://www.linkedin.com/in/l%C3%AA-ngh%C4%A9a-43075a197/"  style="color:orange">Minh nghĩa</a>
               
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='../../vi/'>Serverless Application</a> > Cấu hình cho trích xuất metadata từ hình ảnh: Amazon Rekognition
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Cấu hình cho trích xuất metadata từ hình ảnh: Amazon Rekognition
            </h1>
          

        



	<h4 id="amazon-rekognition-là-gì">Amazon Rekognition là gì?</h4>
<p>Amazon Rekognition giúp chúng ta dễ dàng tải hình ảnh và video và phân tích cho ứng dụng của bạn bằng cách sử dụng công nghệ deep learning (khi sử dụng không cần phải có chuyên môn ở mảng machine learning). Với Amazon Rekognition, bạn có thể xác định objects, people, text, scenes và các activities trong ảnh và videos.</p>
<p>Ở bước này, chúng ta sẽ thêm tính năng dò tìm những objects của ảnh được tải lên và gán labels cho những objects đó.</p>
<h4 id="cấu-hình-amazon-rekognition-integration">Cấu hình Amazon Rekognition Integration</h4>
<p>Vào thư mục <strong>sam/src/handlers/detectLabels</strong> và mở file <strong>app.js</strong>. Coppy đoạn code dưới đây và past vào file đó:</p>
<pre tabindex="0"><code>const { DynamoDBClient } = require(&#39;@aws-sdk/client-dynamodb&#39;)
const { DynamoDBDocumentClient, UpdateCommand } = require(&#39;@aws-sdk/lib-dynamodb&#39;)
const { RekognitionClient, DetectLabelsCommand } = require(&#39;@aws-sdk/client-rekognition&#39;)
const ddbClient = new DynamoDBClient()
const ddbDocClient = DynamoDBDocumentClient.from(ddbClient)
const rekognitionClient = new RekognitionClient()
const tableName = process.env.TASKS_TABLE

exports.handler = async (event) =&gt; {
  console.info(JSON.stringify(event, null, 2))

  const bucket = event.Records[0].s3.bucket.name
  const key = decodeURIComponent(event.Records[0].s3.object.key.replace(/\+/g, &#39; &#39;))

  const user = key.split(&#39;/&#39;)[0]
  const taskId = key.split(&#39;/&#39;)[1]

  const command = new UpdateCommand({
    TableName: tableName,
    Key: { user: `user#${user}`, id: `task#${taskId}` },
    UpdateExpression: &#39;SET upload = :u&#39;,
    ExpressionAttributeValues: {
      &#39;:u&#39;: `s3://${bucket}/${key}`
    },
    ReturnValues: &#39;UPDATED_NEW&#39;
  })

  console.log(`UpdateCommand: ${JSON.stringify(command, null, 2)}`)

  try {
    console.log(`Saving upload for task ${taskId}: s3://${bucket}/${key}`)
    const data = await ddbDocClient.send(command)
    console.log(&#39;UpdateItem succeeded:&#39;, JSON.stringify(data, null, 2))
  } catch (err) {
    console.log(&#39;Unable to update item. Error JSON:&#39;, JSON.stringify(err, null, 2))
    throw err
  }

  console.log(`Detecting labels for bucket ${bucket} and key ${key}`)

  const imageParams = {
    Image: {
      S3Object: {
        Bucket: bucket,
        Name: key
      }
    }
  }

  const labelData = await rekognitionClient.send(
    new DetectLabelsCommand(imageParams)
  )
  console.log(&#39;Success, labels detected.&#39;, labelData)
  const labels = []
  for (let j = 0; j &lt; labelData.Labels.length; j++) {
    const name = labelData.Labels[j].Name
    labels.push(name)
  }

  console.log(`Label data: ${JSON.stringify(labels)}`)

  const updateLabelsCommand = new UpdateCommand({
    TableName: tableName,
    Key: { user: `user#${user}`, id: `task#${taskId}` },
    UpdateExpression: &#39;SET labels = :s&#39;,
    ExpressionAttributeValues: {
      &#39;:s&#39;: labels
    },
    ReturnValues: &#39;UPDATED_NEW&#39;
  })

  try {
    console.log(`Saving labels for task ${taskId}: ${labels}`)
    const data = await ddbDocClient.send(updateLabelsCommand)
    console.log(&#39;UpdateItem succeeded:&#39;, JSON.stringify(data, null, 2))
  } catch (err) {
    console.log(&#39;Unable to update item. Error JSON:&#39;, JSON.stringify(err, null, 2))
    throw err
  }

  const response = {
    statusCode: 200,
    headers: {
      &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;
    },
    body: JSON.stringify(labels)
  }
  return response
}
</code></pre><p>Chức năng chính của đoạn code trên:</p>
<ul>
<li>Đoạn code import AWS SDK và khởi tạo các client cho DynamoDB và Rekognition.</li>
<li>Lấy biến môi trường <strong>TASKS_TABLE</strong> để tạo ra một biến tên <strong>tableName.</strong></li>
<li>Function trích xuất thông tin liên quan đến event object. Nó truy xuất buckect và filename của object được tải lên trong S3 bucket.</li>
<li>Nó tách các key ra để lấy người dùng và ID của task liên kết với object được tải lên.</li>
<li><strong>UpdateCommand</strong> được tạo ra để cập nhật item trong DynamoDB. Command được log ở console cho mục đích debug.</li>
</ul>
<pre tabindex="0"><code>  const command = new UpdateCommand({
    TableName: tableName,
    Key: { user: `user#${user}`, id: `task#${taskId}` },
    UpdateExpression: &#39;SET upload = :u&#39;,
    ExpressionAttributeValues: {
      &#39;:u&#39;: `s3://${bucket}/${key}`
    },
    ReturnValues: &#39;UPDATED_NEW&#39;
  })

  console.log(`UpdateCommand: ${JSON.stringify(command, null, 2)}`)
</code></pre><ul>
<li>Funtion chạy đến <strong>UpdateCommand</strong> để cập nhật item trong DynamoDB. Nó log message khi lưu thông tin của object được tải lên và URL của object đó.</li>
<li>Nếu cập nhật thành công, sẽ có response được log. Nếu không, sẽ có error được log và throw ra.</li>
</ul>
<pre tabindex="0"><code>  try {
    console.log(`Saving upload for task ${taskId}: s3://${bucket}/${key}`)
    const data = await ddbDocClient.send(command)
    console.log(&#39;UpdateItem succeeded:&#39;, JSON.stringify(data, null, 2))
  } catch (err) {
    console.log(&#39;Unable to update item. Error JSON:&#39;, JSON.stringify(err, null, 2))
    throw err
  }
</code></pre><ul>
<li>Function được thực thi để detect các label của hình ảnh được tải lên bằng Amazon Rekognition. Nó log thông báo của hành động detec label trong bucket.</li>
<li>Object imageParams được tạo ra để xác định hình ảnh (S3 object) được detect label.</li>
<li><strong>DetectLabelsCommand</strong> được tạo ra để gọi Rekognition API để detect label của hình ảnh.</li>
<li>Các detected label được lưu trữ trong mảng các labels.</li>
</ul>
<pre tabindex="0"><code>  console.log(`Detecting labels for bucket ${bucket} and key ${key}`)

  const imageParams = {
    Image: {
      S3Object: {
        Bucket: bucket,
        Name: key
      }
    }
  }

  const labelData = await rekognitionClient.send(
    new DetectLabelsCommand(imageParams)
  )
  console.log(&#39;Success, labels detected.&#39;, labelData)
  const labels = []
  for (let j = 0; j &lt; labelData.Labels.length; j++) {
    const name = labelData.Labels[j].Name
    labels.push(name)
  }
</code></pre><p>Tóm lại, Lambda function này xử lí các sự kiện khi có object được tải lên trong S3 bucket. Nó cập nhật item trong DynamoDB với thông tin được tải lên như S3 URL. Sau đó, nó sử dụng Amazon Rekognition để detect labels trong hình ảnh và cập nhật item trong DynamoDB với các detected labels. Function phản hồi bằng một object dạng JSON bao gồm detected labels.</p>
<p>Tiếp theo chúng ta cần thêm một resource mới <code>AWS::Serverless::Function</code> vào file <strong>template.yaml</strong> trong thư mục <strong>sam,</strong> trong mục <strong>Resources,</strong> dưới function <strong>UploadsBucket.</strong> Coppy và paste đoạn code bên dưới vào file <strong>template.yaml</strong> trong thư mục <strong>sam.</strong></p>
<pre tabindex="0"><code># DetectLables Lambda Function
  DetectLabelsFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: src/handlers/detectLabels
      Environment:
        Variables:
          TASKS_TABLE: !Ref TasksTable
      Events:
        ObjectCreatedEvent:
          Type: S3
          Properties:
            Bucket: !Ref UploadsBucket
            Events: s3:ObjectCreated:*
      Handler: app.handler
      Policies:
        - DynamoDBCrudPolicy:
            TableName: !Ref TasksTable
        - RekognitionDetectOnlyPolicy: {}
        - Version: 2012-10-17
          Statement:
            - Effect: Allow
              Action: s3:GetObject*
              Resource: !Sub &#34;arn:aws:s3:::uploads-${AWS::StackName}-${AWS::Region}-${AWS::AccountId}*&#34;
      Runtime: nodejs14.x
</code></pre><p>Chúng sẽ làm như hình dưới đây:</p>
<p><img src="../../images/7.rekog/7-1.png" alt="VPC"></p>
<p>Chú ý ở thuộc tính <strong>ObjectCreatedEvent.</strong> Event này sẽ trigger Lambda function khi một object được tải lên bucket.</p>
<h4 id="deploy-lại-ứng-dụng-sau-khi-thay-đổi">Deploy lại ứng dụng sau khi thay đổi</h4>
<p>Với sự thay đổi code của chúng ta khi chỉnh sửa file <strong>template.yml</strong> và thêm file <strong>detectLabels.js,</strong> chúng ta cần build và deploy lại ứng dụng để thực thi các thay đổi. Chúng ta sẽ deploy chạy lệnh sau:</p>

<div class="notices warning" ><p>Hãy chắn chắn rằng ở terminal, bạn đang ở thư mục <strong>sam</strong>, chạy câu lệnh này <code>cd ~/environment/serverless-tasks-webapp/sam </code></p>
</div>

<p>Đầu tiên chúng ta sẽ build ứng dụng:</p>
<pre tabindex="0"><code>sam build
</code></pre><p>Khi build thành công, chúng ta sẽ thấy như hình:
<img src="../../images/7.rekog/7-2.png" alt="VPC"></p>
<p>Tiếp đến, chúng ta sẽ deploy ứng dụng:</p>
<pre tabindex="0"><code>sam deploy
</code></pre><p>Sau khi deploy thành công, chúng ta sẽ thấy như hình</p>
<p><img src="../../images/7.rekog/7-3.png" alt="VPC"></p>
<p>Bây giờ, chúng ta đã có thể trải nghiệm Amazon Rekognition ở ứng dụng của chúng ta.</p>
<p>Amazon Rekognition sẽ phân tích các hình ảnh được lưu trữ ở Amazon S3 bucket. Ứng dụng web của chúng ta cho phép bạn được tải ảnh lên và gán vào task. Chúng ta làm như sau:</p>
<ol>
<li>Sau khi các bạn tạo một task mới, ở phần <strong>My Tasks</strong>, các bạn sẽ thấy nó và nút <strong>Choose file.</strong> Click vào nút đó để chọn một ảnh từ máy tính của bạn có đuôi PNG, JPEG, etc.</li>
<li>Click vào nút <strong>Upload</strong> để tải ảnh lên.</li>
</ol>
<p><img src="../../images/7.rekog/7-4new.png" alt="VPC"></p>
<p>Sau khi làm các bước trên, bạn sẽ thấy dòng hiển thị quá trình <strong>Detecting Labels.</strong></p>
<p><img src="../../images/7.rekog/7-5new.png" alt="VPC"></p>
<p>Sau khi quá trình detect hoàn tất, bạn sẽ thấy các label được detect hiển thị.</p>
<p><img src="../../images/7.rekog/7-6new.png" alt="VPC"></p>
<h4 id="mô-tả-lại-quá-trình-detect-label-vừa-thực-hiện">Mô tả lại quá trình detect label vừa thực hiện</h4>
<p><img src="../../images/7.rekog/swimlane.svg" alt="VPC"></p>
<ol>
<li>Hình ảnh được tải lên vào S3 bucket</li>
<li>S3 bucket được cấu hình cho phép trigger Lambda function <strong>DetectLabels</strong> khi có object được tạo ra trong bucket.</li>
<li>Lambda function <strong>DetectLabels</strong> được gọi và nó sử dụng Amazon Rekognition để detect label của hình ảnh.</li>
<li>Detected lables được lưu vào DynamoDB.</li>
<li>Ứng dựng refreshes thông tin chi tiết của task.</li>
</ol>
<p>Để ý rằng cách chúng ta thêm một tính năng mới vào ứng dụng của chúng ta mà không thay đổi quá nhiều. Điều này chứng tỏ sự linh hoạt của serverless architectures - khả năng mở rộng và tính module hóa của nó.</p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="../../vi/6-test/6.2-logandmonitor/" title="Logging và Monitoring"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../../vi/8-terminate/" title="Dọn dẹp tài nguyên" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../js/clipboard.min.js?1692235183"></script>
    <script src="../../js/perfect-scrollbar.min.js?1692235183"></script>
    <script src="../../js/perfect-scrollbar.jquery.min.js?1692235183"></script>
    <script src="../../js/jquery.sticky.js?1692235183"></script>
    <script src="../../js/featherlight.min.js?1692235183"></script>
    <script src="../../js/highlight.pack.js?1692235183"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../../js/modernizr.custom-3.6.0.js?1692235183"></script>
    <script src="../../js/learn.js?1692235183"></script>
    <script src="../../js/hugo-learn.js?1692235183"></script>

    <link href="../../mermaid/mermaid.css?1692235183" rel="stylesheet" />
    <script src="../../mermaid/mermaid.js?1692235183"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
